<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.webproject.crowdfunding.repository.GivingDetailRepository">

	<resultMap type="com.webproject.crowdfunding.entity.Giving" id="GivingDetailMap">
		<id property="pageId" column="page_id"/>
		<result property="pageTitle" column="page_title"/>
		<result property="givingTotal" column="giving_total"/>
		<result property="goalTotal" column="goal_total"/>
		<result property="storyTitle" column="story_title"/>
		<result property="storyContent" column="story_content"/>
		<result property="eventStatus" column="event_status"/>
		<result property="imgUrl" column="img_url"/>
		<result property="centerName" column="center_name"/>
		<result property="achievementRate" column="achievement_rate"/>
		<result property="registerDate" column="register_date"/>
		<result property="endDate" column="end_date"/>
	</resultMap>
	
	<select id="getGivingDetail" parameterType="integer" resultMap="GivingDetailMap">
	    select
	        gpt.giving_page_id as page_id,
	        gpt.giving_name as page_title,
	        ct.center_name,
	        gpt.main_img_url as img_url,
	        gt.giving_total as giving_total,
            gpt.story_title,
            gpt.story_content,
	        gpt.category_id,
	        gpt.goal_total,
            gpt.register_date,
            gpt.end_date,
	        if(now() &lt; end_date, '진행중', '종료') as event_status,
	        round(sum(gt.giving_total) / goal_total * 100) as achievement_rate
	    from
	       giving_page_tb gpt
	       left outer join center_tb ct on(ct.center_id = gpt.center_id)
	       left outer join giver_tb gt on(gt.giving_page_id = gpt.giving_page_id)
	       left outer join giving_category_tb gct on(gct.giving_category_id = gpt.category_id)
		where
	       gpt.giving_page_id = #{pageId}
	</select>
	
</mapper>

